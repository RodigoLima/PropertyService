apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-propertyservice
  namespace: property-service
data:
  propertyservice-api.json: |
    {"title":"Property Service API","tags":["propertyservice","dotnet","api"],"timezone":"browser","editable":true,"refresh":"10s","uid":"propertyservice-api","panels":[{"id":1,"title":"Taxa de Requisições HTTP","type":"graph","gridPos":{"h":8,"w":12,"x":0,"y":0},"targets":[{"expr":"rate(http_requests_received_total{namespace=\"property-service\"}[5m])","legendFormat":"{{pod}} - {{method}} {{route}}"}]},{"id":2,"title":"Latência das Requisições (p95)","type":"graph","gridPos":{"h":8,"w":12,"x":12,"y":0},"targets":[{"expr":"histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{namespace=\"property-service\"}[5m]))","legendFormat":"{{pod}} - {{method}} {{route}}"}]},{"id":3,"title":"Requisições por Status Code","type":"graph","gridPos":{"h":8,"w":12,"x":0,"y":8},"targets":[{"expr":"sum by (code) (rate(http_requests_received_total{namespace=\"property-service\"}[5m]))","legendFormat":"Status {{code}}"}]},{"id":4,"title":"Pods Ativos","type":"stat","gridPos":{"h":4,"w":6,"x":12,"y":8},"targets":[{"expr":"count(up{job=\"propertyservice-api\"})","legendFormat":"Pods"}]},{"id":5,"title":"Uso de Memória por Pod","type":"graph","gridPos":{"h":8,"w":12,"x":0,"y":16},"targets":[{"expr":"process_working_set_bytes{namespace=\"property-service\"} / 1024 / 1024","legendFormat":"{{pod}} - Working Set (MB)"}]},{"id":6,"title":"CPU Usage por Pod","type":"graph","gridPos":{"h":8,"w":12,"x":12,"y":16},"targets":[{"expr":"rate(process_cpu_seconds_total{namespace=\"property-service\"}[5m]) * 100","legendFormat":"{{pod}} - CPU %"}]},{"id":7,"title":"Requisições em Progresso","type":"stat","gridPos":{"h":4,"w":6,"x":18,"y":8},"targets":[{"expr":"sum(http_requests_in_progress{job=\"propertyservice-api\"})","legendFormat":"In Progress"}],"options":{"colorMode":"value","graphMode":"area","textMode":"auto"},"fieldConfig":{"defaults":{"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":5},{"color":"red","value":10}]}}}},{"id":8,"title":"Threads Ativas","type":"graph","gridPos":{"h":8,"w":12,"x":0,"y":24},"targets":[{"expr":"process_num_threads{namespace=\"property-service\"}","legendFormat":"{{pod}} - Threads"}]},{"id":9,"title":"Taxa de Erros (4xx/5xx)","type":"graph","gridPos":{"h":8,"w":12,"x":12,"y":24},"targets":[{"expr":"sum by (code) (rate(http_requests_received_total{namespace=\"property-service\", code=~\"4..|5..\"}[5m]))","legendFormat":"HTTP {{code}}"}],"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"}},"overrides":[{"matcher":{"id":"byRegexp","options":"/4.*/"},"properties":[{"id":"color","value":{"fixedColor":"yellow","mode":"fixed"}}]},{"matcher":{"id":"byRegexp","options":"/5.*/"},"properties":[{"id":"color","value":{"fixedColor":"red","mode":"fixed"}}]}]}},{"id":10,"title":"Requisições por Método HTTP","type":"piechart","gridPos":{"h":8,"w":12,"x":0,"y":32},"targets":[{"expr":"sum by (method) (rate(http_requests_received_total{namespace=\"property-service\"}[5m]))","legendFormat":"{{method}}"}],"options":{"legend":{"displayMode":"table","placement":"right","values":["value","percent"]},"pieType":"donut"}},{"id":11,"title":"Latência p50, p95, p99","type":"graph","gridPos":{"h":8,"w":12,"x":12,"y":32},"targets":[{"expr":"histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket{namespace=\"property-service\"}[5m])) by (le))","legendFormat":"p50"},{"expr":"histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{namespace=\"property-service\"}[5m])) by (le))","legendFormat":"p95"},{"expr":"histogram_quantile(0.99, sum(rate(http_request_duration_seconds_bucket{namespace=\"property-service\"}[5m])) by (le))","legendFormat":"p99"}],"fieldConfig":{"defaults":{"unit":"s"}}}]}
